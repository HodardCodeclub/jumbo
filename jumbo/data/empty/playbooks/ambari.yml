---
- hosts: ansiblehost
  become: true
  tasks:
  - name: Create ambariserver ssh_key
    user:
      name: vagrant
      generate_ssh_key: yes
      ssh_key_bits: 4096
      ssh_key_file: "/tmp/id_rsa_ambari"

- hosts: ambariclients
  become: true
  roles:
    - { role: ambariclients, tags: ['ambari', 'ambariclients'] }

- hosts: ambariserver
  become: true
  roles:
    - { role: ambariserver, tags: ['ambari', 'ambariserver'] }

- hosts: ansiblehost
  become: true
  tasks:
  - name: Delete ambariserver ssh_key from ansiblehost
    file:
      path: "/tmp/id_rsa_ambari"
      state: absent

  - name: Delete ambariserver ssh_key.pub from ansiblehost
    file:
      path: "/tmp/id_rsa_ambari.pub"
      state: absent
